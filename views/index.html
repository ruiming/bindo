{% extends "base.html" %}
{% block body %}
    {% include 'header.html' %}
    <h2 class="heading">全部博客</h2>
    <ul class="posts">
        {% for post in posts %}
        <li class="post">
            <a class="post-msg" href="{{post.link}}">
                <p>{{ post.title }}</p>
                <small>{{ post.date|date('Y-m-d H:i:s') }}</small>
            </a>
            <div class="post-option">
                <a href="/rocket/edit/{{post.id}}" class="btn">编辑</a>
                <a href="javascript:void(0)" class="btn delete" id="{{post.id}}" class="btn">删除</a>
            </div>
        </li>
        {% endfor %}
    </ul>
    <script>
    $('.delete').on("click", function(event) {
        event.preventDefault(); 
        var id = $('.delete').attr('id')
        $.ajax({
           url: '/rocket/post/' + id,
           type: 'DELETE',
           // TODO 失败处理
           // 成功删除后移除 localstroage 和该 DOM 节点
           success: function(result) {
                localStorage.removeItem('smde_' + id)
                $('#' + id).parent().parent().remove()
                alert('删除成功')
           }
        })
    })
    </script>
{% endblock %}